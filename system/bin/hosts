echo "Unified Hosts Adblocker"
HOST=/magisk/.core/hosts
TREADME=/cache/treadme
FILTER=/magisk/unifiedhostsadblock/filter
WHITELIST=/sdcard/whitelist
TEMP=/sdcard/temp
wget -q -O $TREADME --no-check-certificate https://raw.githubusercontent.com/StevenBlack/hosts/master/readme.md
grep "Last updated:" $TREADME
if [ -f $FILTER ]; then
	CURRENT=$(grep "Last updated:" $TREADME)
	LAST_UPDATED=$(sed '1q;d' $FILTER)
	if [ "$LAST_UPDATED" != "$CURRENT" ]; then
		echo "Updates are available"
	else
		echo "No updates available"
	fi
else
	touch $FILTER
	echo "No hosts file yet applied"
fi
echo "You can use any combination of the letters below"
echo "For example: inputting 'fps' would yield master+fakenews+porn+social"
while true
do
	echo "Select an option below:"
	echo "--------------------------------"
	echo "'m' for adware+malware"
	echo "'f' for master+fakenews"
	echo "'g' for master+gambling"
	echo "'p' for master+porn"
	echo "'s' for master+social"
	echo "To disable, just toggle the enable systemless hosts in magisk manager"
	echo "'w' to add whitelist"
	echo -n "'q' to quit: "
	read -r INPUT
	DIR=""
	case "$INPUT" in
		m) DIR="master/hosts"
		;;
		f) DIR="master/alternates/fakenews/hosts"
		;;
		fg|gf) DIR="master/alternates/fakenews-gambling/hosts"
		;;
		fgp|fpg|gfp|gpf|pfg|pgf) DIR="master/alternates/fakenews-gambling-porn/hosts"
		;;
		fgps|fgsp|fpgs|fpsg|fspg|fsgp|gfps|gfsp|gpfs|gpsf|gsfp|gspf|pfgs|pfsg|pgfs|pgsf|psfg|psgf|sfgp|sfpg|sgfp|sgpf|spfg|spgf) DIR="master/alternates/fakenews-gambling-porn-social/hosts"
		;;
		fgs|fsg|gfs|gsf|sfg|sgf) DIR="master/alternates/fakenews-gambling-social/hosts"
		;;
		fp|pf) DIR="master/alternates/fakenews-porn/hosts"
		;;
		fps|fsp|pfs|psf|sfp|spf) DIR="master/alternates/fakenews-porn-social/hosts"
		;;
		fs|sf) DIR="master/alternates/fakenews-social/hosts"
		;;
		g) DIR="master/alternates/gambling/hosts"
		;;
		gp|pg) DIR="master/alternates/gambling-porn/hosts"
		;;
		gps|gsp|pgs|psg|sgp|spg) DIR="master/alternates/gambling-porn-social/hosts"
		;;
		gs|sg) DIR="master/alternates/gambling-social/hosts"
		;;
		p) DIR="master/alternates/porn/hosts"
		;;
		ps|sp) DIR="master/alternates/porn-social/hosts"
		;;
		s) DIR="master/alternates/social/hosts"
		;;
		w)  if [ ! -f $WHITELIST ]; then
				echo ""
				echo "*No Whitelist detected*"
				echo "Copy your whilelist to /sdcard"
				echo ""
		    else
				if [ -f "$HOST" ]; then
					echo "Applying Whitelist"
					mv $HOST $TEMP
					grep -vFf $WHITELIST $TEMP > $HOST
					rm -f $TEMP
				else
					echo ""
					echo "No hosts file detected"
					echo "Apply a hosts file first"
					echo ""
				fi
		    fi
		;;
		q) break
		;;
		*)  echo ""
			echo "Invalid input. Don't use any spaces between letters"
			echo ""
		;;
	esac
	if [ $DIR ]; then
		wget -O $HOST --no-check-certificate https://raw.githubusercontent.com/StevenBlack/hosts/$DIR
		grep "Last updated:" $TREADME > $FILTER
	fi
rm -f $TREADME
done
echo "Done!"